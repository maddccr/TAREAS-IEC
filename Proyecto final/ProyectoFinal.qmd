---
title: "ProyectoFinal"
format: html
editor: visual
---

## Quarto

Simulacion de un modelo de crecimiento logistico mediante ABM

dN/dt = rN\[(K − N)/K\]

r = b-d o r = (b − d) + (i − e)

```{r}


#K --> capacidad de carga
#N --> cantidad de individuos // varia con el tiempo
#years --> numero de iteraciones OJO 
#Fijamos una tasa de muerte y natalidad ?.?


ABM <- function(K, iter, p_death, p_birth) {
  
  #Inicializar el ABM
  #Creacion del ambiente
  
  habSize <- ceiling(sqrt(K)) #quemos una grilla LxL que pueda ocupar K individuos
  L <- habSize^2
  habitat <- rep(0, L) #habitad vacia
  
  #Cantidad inicial de agentes (1%)
  N0 <- round(0.01 * K) #incorporar como parametro? 
  
  #Posicionar de forma aleatoria
  habitat[sample(1:L, N0)] <- 1 #1 = lleno
  
  #Lo que se busca monitonear es la cantidad de agentes en el tiempo
  N <- c() #crecieminto dinamico
  
  
  #ahora si
  
  for(t in 1:iter){
    
    vivos <- which(habitat == 1) #recuperar los ind donde el hab esta ocupado
    
    #MUERTES: a cada agente vivo se le asigna una probabilidad a partir de una unif(0,1). Si p < p_death --> r.i.p
    
    for(agente in vivos){
      if( runif(1) < p_death){
        habitat[agente] <- 0
      }
    }
    
    #NACIMIENTOS 
    #para simular el compartamiento logistico es necesario que la p_birth sea controlada por la carga del ambiente
    
    n <- sum(habitat == 1) #sumamos los vivos
    p_birth_K <- p_birth*(1 - n / K) #por la limitaciones de la carga, a medida que aumenta N, disminuye la prob de nacer
    
    
    for(agent in vivos){
      if (runif(1) < p_birth_K){
        libres <- which(habitat == 0) #ind de espacios libres en la grilla
        if(length(libres) > 0){ 
        habitat[sample(libres, 1)]  <- 1 #elijo un ind aleatorio para colocar
        }
      }
    }
    
  #Actualizar la cantidad de agentes
    
    N <- c(N, sum(habitat == 1))
  
    


    if(t %in% seq(1, iter - iter/2, by = 5)){
       habCuadrado <- matrix(habitat, nrow=habSize, byrow=TRUE)
       image(habCuadrado, col = c("white","black"), axes = FALSE, asp = 1)
    }


}
  
#intento de vizualizacion
  

  
return(N)
  
}


#arranca optima // abundancia de recursos 
N <- ABM(100, 60, 0.3, 0.8)


plot(N, type="l", 
       xlab="Tiempo", ylab="Población N(t)",
       main="ABM - Crecimiento Logístico")


#PROBAR ANIMAR / GIF O ELEGIR CORTES DE TIEMPO

```

```{r}

#EXTENDER EL MODELO AGREGANDO SEXO BIOLOGICO
ABM_ext <- function(K, iter, p_death, p_birth) {
  
  #Inicializar el ABM
  #Creacion del ambiente
  
  habSize <- ceiling(sqrt(K)) #quemos una grilla LxL que pueda ocupar K individuos
  L <- habSize^2
  habitat <- rep(0, L) #habitad vacia
  
  #Cantidad inicial de agentes (1%)
  N0 <- round(0.05 * K) #incorporar como parametro? 
  
  #PARA EVITAR EXTINCION SUBITA > 5%
  
  #Posicionar de forma aleatoria
  habitat[sample(1:L, N0)] <- 1 #1 = lleno
  
  #Lo que se busca monitonear es la cantidad de agentes en el tiempo
  N <- c() #crecieminto dinamico
  
  #INICIALIZAR LA EXTENCION
  bio_sex <- rep(NA, L)
  bio_sex[which(habitat ==1)] <- rbinom(N0, 1, 0.5)
  #a cada agente inicial le asigno un sexo bio (1= fem 0 = masc) con 50% de prob
  
  #ahora si
  
  for(t in 1:iter){
    
    vivos <- which(habitat == 1) #recuperar los ind donde el hab esta ocupado
    
    #MUERTES: a cada agente vivo se le asigna una probabilidad a partir de una unif(0,1). Si p < p_death --> r.i.p
    
    for(agente in vivos){
      if( runif(1) < p_death){
        habitat[agente] <- 0
        bio_sex[agente] <- NA
      }
    }
    
    #NACIMIENTOS 
    #para simular el compartamiento logistico es necesario que la p_birth sea controlada por la carga del ambiente
    
    n <- sum(habitat == 1) #sumamos los vivos
    p_birth_K <- p_birth*(1 - n / K) #por la limitaciones de la carga, a medida que aumenta N, disminuye la prob de nacer
    
    
    for(agent in vivos){
      if(!is.na(bio_sex[agent]) & bio_sex[agent] == 1) {
        if (runif(1) < p_birth_K){
          libres <- which(habitat == 0) #ind de espacios libres en la grilla
          if(length(libres) > 0){ 
          i <- sample(libres, 1)
          habitat[i]  <- 1 #elijo un ind aleatorio para colocar
          bio_sex[i] <- rbinom(1, 1, 0.5)
          }
        }
      }
    }
    
  #Actualizar la cantidad de agentes
    
    N <- c(N, sum(habitat == 1))
    
    plot_grid <- rep(0, L)
    plot_grid[which(habitat == 1 & bio_sex == 0)] <- 1
    plot_grid[which(habitat == 1 & bio_sex == 1)] <- 2
    
    
    if(t %in% seq(1, iter - iter/2, by = 5)){
        
      habCuadrado <- matrix(plot_grid, nrow=habSize, byrow=TRUE)
      image(habCuadrado, col = c("white", "pink", "purple"), axes = FALSE, asp = 1)
      #title(main = paste("Iteración", t, " - N =", N[length(N)]))
    }
  
}
  
#intento de vizualizacion
  

  
return(N)
  
}


N <- ABM_ext(1000, 60, 0.1, 0.9)


plot(N, type="l", 
       xlab="Tiempo", ylab="Población N(t)",
       main="ABM - Crecimiento Logístico")


#1000 03 - 09 extincion


```
