---
title: "ProyectoFinal"
format: html
editor: visual
---

## Quarto

Simulacion de un modelo de crecimiento logistico mediante ABM

dN/dt = rN\[(K − N)/K\]

r = b-d o r = (b − d) + (i − e)

```{r}


#K --> capacidad de carga
#N --> cantidad de individuos // varia con el tiempo
#years --> numero de iteraciones OJO 
#Fijamos una tasa de muerte y natalidad ?.?


ABM <- function(K, iter, p_death, p_birth) {
  
  #Inicializar el ABM
  #Creacion del ambiente
  
  habSize <- ceiling(sqrt(K)) #quemos una grilla LxL que pueda ocupar K individuos
  L <- habSize^2
  habitat <- rep(0, L) #habitad vacia
  
  #Cantidad inicial de agentes (1%)
  N0 <- round(0.01 * K) #incorporar como parametro? 
  
  #Posicionar de forma aleatoria
  habitat[sample(1:L, N0)] <- 1 #1 = lleno
  
  #Lo que se busca monitonear es la cantidad de agentes en el tiempo
  N <- c() #crecieminto dinamico
  
  
  #ahora si
  
  for(t in 1:iter){
    
    vivos <- which(habitat == 1) #recuperar los ind donde el hab esta ocupado
    
    #MUERTES: a cada agente vivo se le asigna una probabilidad a partir de una unif(0,1). Si p < p_death --> r.i.p
    
    for(agente in vivos){
      if( runif(1) < p_death){
        habitat[agente] <- 0
      }
    }
    
    #NACIMIENTOS 
    #para simular el compartamiento logistico es necesario que la p_birth sea controlada por la carga del ambiente
    
    n <- sum(habitat == 1) #sumamos los vivos
    p_birth_K <- p_birth*(1 - n / K) #por la limitaciones de la carga, a medida que aumenta N, disminuye la prob de nacer
    
    
    for(agent in vivos){
      if (runif(1) < p_birth_K){
        libres <- which(habitat == 0) #ind de espacios libres en la grilla
        if(length(libres) > 0){ 
        habitat[sample(libres, 1)]  <- 1 #elijo un ind aleatorio para colocar
        }
      }
    }
    
  #Actualizar la cantidad de agentes
    
    N <- c(N, sum(habitat == 1))
  
    
 habCuadrado <- matrix(habitat, nrow=habSize, byrow=TRUE)

image(
  t(habCuadrado[nrow(habCuadrado):1, ]),
  col=c("white","black"),
  axes=FALSE,
  asp=1
)

}
  
#intento de vizualizacion
  

  
return(N)
  
}


#arranca optima // abundancia de recursos 
N <- ABM(100, 100, 0.3, 0.8)


plot(N, type="l", 
       xlab="Tiempo", ylab="Población N(t)",
       main="ABM - Crecimiento Logístico")


#PROBAR ANIMAR / GIF O ELEGIR CORTES DE TIEMPO

```

```{r}

#EXTENDER EL MODELO AGREGANDO SEXO BIOLOGICO
ABM_extencion <- function(K, iter, p_death, p_birth) {
  
  #Inicializar el ABM
  #Creacion del ambiente
  
  habSize <- ceiling(sqrt(K)) #quemos una grilla LxL que pueda ocupar K individuos
  L <- habSize^2
  habitat <- rep(0, L) #habitad vacia
  
  #Cantidad inicial de agentes (1%)
  N0 <- round(0.01 * K) #incorporar como parametro? 
  
  #Posicionar de forma aleatoria
  habitat[sample(1:L, N0)] <- 1 #1 = lleno
  
  #Lo que se busca monitonear es la cantidad de agentes en el tiempo
  N <- c() #crecieminto dinamico
  
  
  #ahora si
  
  for(t in 1:iter){
    
    vivos <- which(habitat == 1) #recuperar los ind donde el hab esta ocupado
    
    #MUERTES: a cada agente vivo se le asigna una probabilidad a partir de una unif(0,1). Si p < p_death --> r.i.p
    
    for(agente in vivos){
      if( runif(1) < p_death){
        habitat[agente] <- 0
      }
    }
    
    #NACIMIENTOS 
    #para simular el compartamiento logistico es necesario que la p_birth sea controlada por la carga del ambiente
    
    n <- sum(habitat == 1) #sumamos los vivos
    p_birth_K <- p_birth*(1 - n / K) #por la limitaciones de la carga, a medida que aumenta N, disminuye la prob de nacer
    
    
    for(agent in vivos){
      if (runif(1) < p_birth_K){
        libres <- which(habitat == 0) #ind de espacios libres en la grilla
        if(length(libres) > 0){ 
        habitat[sample(libres, 1)]  <- 1 #elijo un ind aleatorio para colocar
        }
      }
    }
    
  #Actualizar la cantidad de agentes
    
    N <- c(N, sum(habitat == 1))
  
    
 habCuadrado <- matrix(habitat, nrow=habSize, byrow=TRUE)



}
  
#intento de vizualizacion
  

  
return(N)
  
}

```
